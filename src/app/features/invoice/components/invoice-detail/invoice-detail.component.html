<div>
  <div class="info-container">
    <div class="position-absolute" style="height: 1.75rem; right: 1rem;">
      <p-button styleClass="h-100 px-2" (click)="openInvoiceDialog()" [disabled]="loading">Editar Factura</p-button>
    </div>
    <div class="mt-1">
      <div class="row">
        <div class="col-12">
          <b>Emite (CIF)</b>
          <div>{{ invoice.issuer }} ({{ invoice.nif }})</div>
        </div>
        <div class="col-12 col-sm-6 col-md-4">
          <b>Importe</b>
          <div>{{ invoice.amount | currencyEuro }}</div>
        </div>
        <div class="col-12 col-sm-6 col-md-4">
          <b>Fecha de Factura</b>
          <div>{{ invoice.invoiceDate | date:"dd/MM/yyyy" }}</div>
        </div>
        <div class="col-12 col-sm-6 col-md-4">
          <b>Fecha de Pago</b>
          <div>{{ invoice.paymentDate | date:"dd/MM/yyyy" }}</div>
        </div>
        <div class="col-12 col-sm-6 col-md-4">
          <b>Número de factura</b>
          <div>{{ invoice.invoiceNumber }}</div>
        </div>
        <div class="col-12 col-sm-6 col-md-4">
          <b>Forma de pago</b>
          <div>{{ invoice.method | titlecase }}</div>
        </div>
        <div class="col-12 col-sm-6 col-md-4">
          <b>Genera</b>
          <div>{{ invoice.payer.payer }}</div>
        </div>
        <div class="col-12 col-sm-6 col-md-4">
          <b>Usada en Subvención</b>
          <div>{{ invoice.grant?.grantName || 'Ninguna' }}</div>
        </div>
        <div class="col">
          <b>Concepto</b>
          <div>{{ invoice.expenseType.description | titlecase }}</div>
        </div>
        <div class="col-12 mb-2">
          <b>Observaciones</b>
          <div>{{ invoice.observations || 'Ninguna' }}</div>
        </div>
        <div class="col-12 d-flex flex-row flex-wrap gap-4 align-items-end">
          <div class="d-flex flex-column">
            <b>Recibí</b>
            <div>{{ invoice.receipt | boolean }}</div>
          </div>
          <div class="d-flex flex-column">
            <b>Cumple</b>
            <div>{{ invoice.complies | boolean }}</div>
          </div>
          <div class="d-flex flex-column">
            <b>Liquidada</b>
            <div>{{ invoice.liquidated | boolean }}</div>
          </div>
        </div>
        <div class="col-12">
          <b>Documentos</b>
          @if (invoice.files.length == 0) {
            <div>No hay documentos asociados a esta factura</div>
          } @else {
            <p-table
              stripedRows
              [value]="invoice.files"
            >
              <ng-template pTemplate="body" let-file>
                <tr>
                  <td>
                    <span class="text-decoration-underline cursor-pointer" (click)="openFile(file.id)">
                      {{ file.name }}
                    </span>
                  </td>
                  <td>
                    <div class="d-flex justify-content-end gap-2">
                      <p-button
                        #button
                        size="small"
                        variant="outlined"
                        styleClass="border-2 icon-button-x-small"
                        icon="pi pi-download"
                        title="Descargar"
                        [disabled]="loading"
                        (onClick)="downloadFile(file.id, button)"
                      ></p-button>
                      <p-button
                        #button
                        size="small"
                        variant="outlined"
                        severity="danger"
                        styleClass="border-2 icon-button-x-small"
                        icon="pi pi-trash"
                        title="Borrar"
                        [disabled]="loading"
                        (onClick)="deleteFileConfirmation(file.id, button)"
                      ></p-button>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          }
          <p-fileupload
            #uploader
            mode="basic"
            [chooseButtonProps]="{label: 'Subir Documentos', size: 'small', styleClass: 'py-1'}"
            [disabled]="loading"
            styleClass="justify-content-start mt-2"
            chooseIcon="fa-solid fa-upload"
            [accept]="allowedFiles"
            [maxFileSize]="maxFileUploadByteSize"
            (uploadHandler)="uploadFile($event, uploader)"
            [customUpload]="true"
            [auto]="true"
            [multiple]="true"
            [fileLimit]="fileLimit"
            invalidFileSizeMessageSummary="{0}: Tamaño del archivo inválido, "
            invalidFileSizeMessageDetail="el tamaño máximo es {0}."
            invalidFileTypeMessageSummary="{0}: Tipo de archivo inválido, "
            invalidFileTypeMessageDetail="los archivos permitidos son: {0}."
            invalidFileLimitMessageSummary="Número máximo de archivos alcanzado, "
            invalidFileLimitMessageDetail="el límite de subida es de {0} archivos simultáneamente."
          />
        </div>
      </div>
    </div>
  </div>
</div>
