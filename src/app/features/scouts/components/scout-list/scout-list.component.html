<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-end mb-3">
    <h1 class="mb-0 d-flex me-3">Lista de personas educandas</h1>
    <div>
      <p-button
        title="Añadir Educanda"
        icon="pi pi-user-plus"
        (click)="openAddDialog()"
      ></p-button>
    </div>
  </div>
  <p-table
    #dt
    showGridlines
    [value]="scouts"
    [paginator]="true"
    [rows]="25"
    [rowsPerPageOptions]="[10,25,50,100,300]"
    [loading]="!scouts"
    sortField="surname"
    [filters]="{enabled: { value: false, matchMode: 'notContains' }}"
  >
    <ng-template pTemplate="caption">
      <div class="d-flex justify-content-between align-items-center">
        <span>Número de personas educandas: {{ dt.totalRecords }}</span>
        <p-button
          [icon]="excelLoading ? 'pi pi-spin pi-spinner' : 'pi pi-file-excel'"
          [disabled]="excelLoading"
          (click)="exportExcelScout()"
          severity="success"
          title="Descargar scouts como excel"
        ></p-button>
      </div>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="surname">
          Nombre
          <p-sortIcon field="surname"></p-sortIcon>
        </th>
        <th pSortableColumn="groupId">
          Unidad
          <p-sortIcon field="groupId"></p-sortIcon>
        </th>
        <th class="text-center w-min">
          Baja
        </th>
        <th class="text-center w-min">
          Acciones
        </th>
      </tr>
      <tr class="input-max-width">
        <th>
          <input
            pInputText
            type="text"
            (input)="dt.filter($any($event.target).value, 'id', 'name-surname-filter')"/>
        </th>
        <th>
          <p-multiSelect
            [options]="groups"
            (onChange)="dt.filter($event.value, 'groupId', 'in')"
            [showHeader]="false"
            [autofocusFilter]="false"
            [showClear]="true"
            appendTo="body"
            scrollHeight="300px"
            optionLabel="name"
            optionValue="id"
            styleClass="w-100 fw-normal"
          ></p-multiSelect>
        </th>
        <th class="text-center">
          <p-columnFilter
            type="boolean"
            field="enabled"
            matchMode="equals"
            [showClearButton]="false"
          ></p-columnFilter>
        </th>
        <th></th>
      </tr>
    </ng-template>
    <ng-template
      pTemplate="body"
      let-scout
    >
      <tr>
        <td>
          {{ scout.surname }}, {{ scout.name }}
        </td>
        <td>
          {{ scout.groupId | group }}
        </td>
        <td class="text-center">
          <span>
            {{ scout.enabled ? 'No' : 'Sí' }}
          </span>
        </td>
        <td>
          <div class="d-flex flex-row gap-2 justify-content-center">
            @if (scout.enabled) {
              <app-table-icon-button
                icon="pi pi-user-edit"
                title="Editar"
                (click)="openEditDialog(scout)"
              ></app-table-icon-button>
            }
            <app-table-icon-button
              [disabled]="loading"
              icon="pi pi-trash"
              title="Eliminar"
              severity="danger"
              (click)="deleteScout(scout)"
            ></app-table-icon-button>
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="4">No se han encontrado personas educandas</td>
      </tr>
    </ng-template>
  </p-table>
</div>
