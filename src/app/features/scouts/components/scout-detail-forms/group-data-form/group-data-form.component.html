<div>
  <form class="form-container" (ngSubmit)="submit()" [formGroup]="formHelper.form">
    <app-scout-type-form
      [parentForm]="formHelper.form"
      (onGroupSelect)="updateFormValues($event)"
    ></app-scout-type-form>
    <div class="row">
      <div class="col-12">
        <div class="d-flex flex-column">
          <label class="required" for="federated">Federada</label>
          <p-select-button
            id="federated"
            class="w-fit"
            [options]="yesNoOptions"
            [allowEmpty]="false"
            formControlName="federated"
          ></p-select-button>
        </div>
      </div>
      <div class="row align-items-baseline" formArrayName="registrationDates">
        @let array = formHelper.getFormArray('registrationDates').controls;
        <div class="d-flex align-items-center gap-2 mb-2">
          <b class="fs-5 title-font">Fechas de alta y baja</b>
          <p-button
            label="Añadir"
            size="small"
            styleClass="py-1"
            (onClick)="addRegistrationDateForm()"
            [disabled]="loading"
          ></p-button>
        </div>
        @for (control of array; track control) {
          @let endDateBefore = formHelper.hasFormError('endDateBefore', 'registrationDates', $index.toString());
          @let datesOverlap = formHelper.hasFormError('datesOverlap', 'registrationDates', $index.toString());
          <div class="col-12 col-sm-6 row gx-2 gy-0 mx-0 mb-0" [formGroupName]="$index">
            <div class="d-flex align-items-center gap-2">
              <b class="fs-6 title-font mt-1" id="registration-{{$index}}">Fecha {{ $index + 1 }}</b>
              <p-button
                label="Borrar"
                size="small"
                severity="danger"
                styleClass="py-1"
                (onClick)="deleteRegistrationDateForm($index)"
                [disabled]="loading"
              ></p-button>
            </div>
            <div class="col-12 col-md-6">
              <p-float-label variant="on">
                <p-date-picker
                  formControlName="registrationDate"
                  [class]="datesOverlap ? 'ng-invalid ng-dirty' : ''"
                  [ngClass]="{'border-invalid' : datesOverlap }"
                />
                <label class="required" for="type">Fecha de alta</label>
              </p-float-label>
              @if (datesOverlap) {
                <small class="text-danger">La fecha de alta debe ser posterior a la última fecha de baja</small>
              }
            </div>
            <div class="col-12 col-md-6">
              <p-float-label variant="on">
                <p-date-picker
                  formControlName="unregistrationDate"
                  [ngClass]="{'border-invalid' : endDateBefore  }"
                />
                <label for="type" [ngClass]="{'required' : $index < array.length - 1 }">Fecha de baja</label>
              </p-float-label>
              @if (endDateBefore) {
                <small class="text-danger">La fecha de baja debe ser posterior a la de alta</small>
              }
            </div>
          </div>
        }
      </div>
    </div>
    <app-save-buttons
      saveType="submit"
      class="mt-3"
      [showCancelButton]="true"
      (onCancel)="onEditionStop.emit()"
      [saveLoading]="loading"
      [showErrorMessage]="formHelper.isDirtyAndInvalid()"
    ></app-save-buttons>
  </form>
</div>
