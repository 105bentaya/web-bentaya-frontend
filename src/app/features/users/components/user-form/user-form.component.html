<div class="container text-center">
  <h1>{{ user ? "Editar Usuario" : "Crear Nuevo Usuario" }}</h1>
  @if (userForm.form) {
    <div class="d-flex flex-column justify-content-center">
      <form (submit)="onSubmit()" [formGroup]="userForm.form" class="form-container">
        <div class="row">
          <div class="col-6">
            <label class="required" for="username">
              Nombre de Usuario
            </label>
            <input
              id="username"
              pInputText
              type="text"
              formControlName="username"
            >
          </div>
          <div class="col-6">
            <label class="required" for="password">
              Contrase√±a
            </label>
            <p-password
              id="password"
              formControlName="password"
              [toggleMask]="true"
              [feedback]="false"
            ></p-password>
          </div>
          <div class="col-12">
            <label class="required" for="roles">
              Roles
            </label>
            <p-multiSelect
              id="roles"
              placeholder="Seleccionar roles"
              [options]="roles"
              [filter]="false"
              [autofocusFilter]="false"
              formControlName="roles"
              optionValue="name"
              (onChange)="onRolesChange()"
            >
              <ng-template let-selectedIds pTemplate="selectedItems">
                @if (!selectedIds || selectedIds.length === 0) {
                  <div>Seleccionar roles</div>
                } @else {
                  {{ selectedIds | roles }}
                }
              </ng-template>
              <ng-template let-role pTemplate="items">
                <div>{{ role.name | role }}</div>
              </ng-template>
            </p-multiSelect>
          </div>
          @if (isScouter()) {
            <div class="col">
              <label class="required" for="groupId">
                Unidad del Scouter
              </label>
              <p-dropdown
                id="groupId"
                [options]="groups"
                formControlName="groupId"
                optionLabel="name"
                optionValue="id"
                placeholder="Unidad del Scouter"
              ></p-dropdown>
            </div>
          }
          @if (isUser()) {
            <div class="col">
              <label class="required" for="scoutIds">
                Educanda(s) asociados
              </label>
              <p-multiSelect
                id="scoutIds"
                [options]="scouts"
                formControlName="scoutIds"
                optionLabel="name"
                optionValue="id"
                placeholder="Seleccionar educandas"
                [loading]="!scouts"
              >
                <ng-template let-scout pTemplate="item">
                  {{ scout.surname }}, {{ scout.name }} - <small>{{ scout.birthday | date: "d/MM/y" }}</small>
                </ng-template>
                <ng-template let-value pTemplate="selectedItems">
                  @if (!value || value.length === 0) {
                    <div>Seleccionar educandas</div>
                  } @else {
                    {{ value | join:'name' }}
                  }
                </ng-template>
              </p-multiSelect>
            </div>
          }
          <app-save-buttons
            class="mt-3"
            [saveLabel]="user ? user.enabled ? 'Guardar' : 'Reactivar' : 'Crear'"
            [saveLoading]="loading"
            saveType="submit"
            (onCancel)="goBack()"
            [showCancelButton]="true"
          ></app-save-buttons>
        </div>
      </form>
    </div>
  } @else {
    <app-basic-loading-info></app-basic-loading-info>
  }
</div>
